<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Securin CPE Viewer</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-6 text-center">Securin CPEs</h1>

=    <div class="mb-4 grid grid-cols-1 md:grid-cols-3 gap-2">
      <input id="search-input" type="text" placeholder="Search by CPE title..." class="p-2 border rounded" />
      <input id="deprecation-input" type="text" placeholder="Filter by Deprecation Date (e.g. 2021)" class="p-2 border rounded" />
      <button id="search-btn" class="bg-blue-600 text-white px-4 py-2 rounded">Search</button>
    </div>

=    <div id="loader" class="text-center text-gray-600 mb-4">Loading...</div>
    <ul id="product-list" class="space-y-4"></ul>

    <div class="flex justify-between mt-6">
      <button id="prev" class="bg-blue-500 text-white px-4 py-2 rounded">Prev</button>
      <span id="page" class="text-lg font-semibold">Page 1</span>
      <button id="next" class="bg-blue-500 text-white px-4 py-2 rounded">Next</button>
    </div>
  </div>

  <script>
    let page = 1;
    const limit = 10;
    let search = '';
    let deprecation = '';

    const loadProducts = async () => {
      document.getElementById("loader").innerText = "Loading...";

      const isSearch = search.trim() !== '' || deprecation.trim() !== '';
      const endpoint = isSearch ? '/api/search' : '/api/cpes';
      const url = `${endpoint}?page=${page}&limit=${limit}${
        isSearch ? `&search=${encodeURIComponent(search)}&deprecation=${encodeURIComponent(deprecation)}` : ''
      }`;

      const res = await fetch(url);
      const data = await res.json();

      const list = document.getElementById("product-list");
      list.innerHTML = "";

      if (!data.products || data.products.length === 0) {
        document.getElementById("loader").innerText = "No products found.";
        return;
      }

      data.products.forEach(product => {
        const item = document.createElement("li");
        item.className = "bg-white p-4 rounded shadow";
        item.innerHTML = `
          <h2 class="text-xl font-semibold">${product.cpe_title}</h2>
          <p class="text-sm text-gray-600">URI: ${product.cpe_23_uri}</p>
          <p class="text-sm text-gray-600">Deprecation Date: ${product.cpe_23_deprecation_date || "N/A"}</p>
        `;
        list.appendChild(item);
      });

      document.getElementById("loader").innerText = "";
      document.getElementById("page").innerText = `Page ${page}`;
    };

    document.getElementById("search-btn").addEventListener("click", () => {
      search = document.getElementById("search-input").value;
      deprecation = document.getElementById("deprecation-input").value;
      page = 1;2
      loadProducts();
    });

    document.getElementById("prev").addEventListener("click", () => {
      if (page > 1) {
        page--;
        loadProducts();
      }
    });

    document.getElementById("next").addEventListener("click", () => {
      page++;
      loadProducts();
    });

    loadProducts(); // Initial load
  </script>
</body>
</html>
